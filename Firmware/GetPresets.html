<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" type="text/css" href="assets/styles/main.css">
		<script src="assets/scripts/get_presets.js"></script>
		<script src="assets/scripts/modules.js"></script>
	</head>
	<body>
			<p id="title" style="font-family:'Arial';font-size:16px">
					Fetch Presets from Module
			</p>
			<button id="button">Fetch Presets</button>
			<select id="moduleSelect" required>
				<option value="Select">Select....</option>
			</select>
		<p id="result" style="font-family:'Arial';font-size:12px"></p>
		<div id="saveDiv">
			<a id="saveLink" href="data:application/xml;charset=utf-8,this is a test?" download="filename.json">Save</a>
		</div>
	</body>
	<script>
		const HTTP_REQUEST_TIMEOUT = 12000; //Long for 251e.

		var module_address;
		var module_name;
		var request;
		var module_selector = document.getElementById("moduleSelect");
		var select_button = document.getElementById("button");
		var save_div = document.getElementById("saveDiv");
		var result = document.getElementById("result");

		window.onload = (event) => {
			// create html select options from a hash constant
			for (var module in modules) {
				var el = document.createElement("option");
				el.value = module;
				el.textContent = modules[module];
				module_selector.appendChild(el);
			}
		}

		save_div.style.visibility = "hidden";

		module_selector.onchange = e => {
			result.innerHTML = "";
			save_div.style.visibility = "hidden";
		}

		//Get preset button.
		select_button.onclick = function () {
			save_div.style.visibility = "hidden";
			module_address = moduleSelect.value;
			module_name = moduleSelect.options[moduleSelect.selectedIndex].text;
			result.innerHTML = "Please select a module.<br/>";
			if (module_address != "Select") {
				request = new XMLHttpRequest();
				request.timeout = HTTP_REQUEST_TIMEOUT; // time in milliseconds
				request.onload = requestOnLoad;
				request.ontimeout = requestOnTimeout;
				request.open("GET", "http://192.168.0.1/getpresets?addr=" + module_address);
				request.send(null);
				result.innerHTML = "Sending request for presets at address " + module_address + "<br/>";
			}
		};
	</script>
</html>
